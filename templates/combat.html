<!DOCTYPE html>
<html>
<head>
    <title>Combat Map</title>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.0/sockjs.min.js"></script>
    <script>
        $(document).ready(function() {
            var socket = new SockJS('/combat_socket');
            socket.onmessage = function(e) {
                var data = JSON.parse(e.data);
                if (data.type === 'map') {
                    $('#map').text(data.map);
                }
            };
            socket.onopen = function() {
                console.log('WebSocket connected');
            };
            socket.onclose = function() {
                console.log('WebSocket disconnected');
            };
        });
    </script>
</head>
<body>
    <pre id="map">{{ map }}</pre>
    <div class="test">
        Vous jouer en {{ gamemode }} <br><br>
        
        <form action="/combat?gamemode={{gamemode}}" method="POST">
            <label for="story">CMD:</label>
            <div class="textArea">
                <p>{{user}}@eda#.prog></p>
                <textarea id="story" name="code" rows="13" required placeholder="Votre code..."></textarea>
            </div>
            <input type="submit" value="Lancer"><br>
        {% if code_entrer %}
        votre ancien code est {{code}}
        <br><br>
        {% endif %}
        </div>    
</body>
</html>